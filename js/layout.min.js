(function(){"use strict";var ENTER_KEY_CODE=13;var MOUSE_CLICK_CODE=1;var textAlignment='right';var queryInput,resultDiv,clickSubmit,resultWrapperDiv,accessTokenInput="38772fe1c44b4cb7aadc94f38bc129eb";window.onload=init;function init(){queryInput=document.getElementById("q");resultDiv=document.getElementById("result");resultWrapperDiv=document.getElementById("resultWrapper");queryInput.addEventListener("keydown",queryInputKeyDown);clickSubmit=document.getElementById("submit_btn");clickSubmit.addEventListener("click",queryInputKeyDown);document.getElementById("placeholder").style.display="none";document.getElementById("main-wrapper").style.display="block";setAccessToken();}
function sanitarize(string){var map={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;',"/":'&#x2F;',};var reg=/[&<>"'/]/ig;return(typeof string!=='undefined'&&string!=null)?string.replace(reg,(match)=>(map[match])):null;}
function setAccessToken(){document.getElementById("placeholder").style.display="none";document.getElementById("main-wrapper").style.display="block";window.init("38772fe1c44b4cb7aadc94f38bc129eb");}
function addUserInput(value){resultWrapperDiv.scrollTop=resultWrapperDiv.scrollHeight;createQueryNode(value);var responseNode=createResponseNode();sendText(value).then(function(response){var result;try{result=response;}catch(error){result="";}
setResponseOnNode(result,responseNode);}).catch(function(err){setResponseOnNode("Unable to process that. Can you check network connection and try again?",responseNode);});}
function addUrlInput(value){window.open(encodeURI(value),'_blank');}
function addPhoneInput(value){window.open('tel:'+encodeURI(value));}
function showLoginInput(lblusr,lblpwd,lblsubmit){resultWrapperDiv.scrollTop=resultWrapperDiv.scrollHeight;var useridNode=document.createElement('input');var pwdNode=document.createElement('input');useridNode.setAttribute('type','text');pwdNode.setAttribute('type','password');if(typeof lblusr=="undefined"||lblusr==null)lblusr="Provide your User Id"
if(typeof lblpwd=="undefined"||lblpwd==null)lblpwd="Provide your Password"
useridNode.setAttribute('placeholder',lblusr);pwdNode.setAttribute('placeholder',lblpwd);var buttonnode=document.createElement('input');buttonnode.setAttribute('type','button');buttonnode.className+='btns';buttonnode.setAttribute('value',lblsubmit);var node=createLoginNode();node.appendChild(useridNode);node.appendChild(pwdNode);node.appendChild(buttonnode);buttonnode.addEventListener('click',function(){var useridVal=sanitarize(useridNode.value);var pwdVal=sanitarize(pwdNode.value);if(useridVal==null||useridVal=="")alert("Please provide your User Id");else if(pwdVal==null||pwdVal=="")alert("Please provide your Password");else{var eventData={"userid":useridVal,"pwd":pwdVal};sendLoginInput(node,eventData);}});resultWrapperDiv.scrollTop=resultWrapperDiv.scrollHeight;}
function sendLoginInput(responseNode,value){sendEvent("actions.intent.LOGIN",value).then(function(response){var result;try{result=response}catch(error){result="";}
setResponseOnNode(result,responseNode);}).catch(function(err){setResponseOnNode("Unable to process that. Can you check network connection and try again?",responseNode);});}
function queryInputKeyDown(event){if(event.which!==ENTER_KEY_CODE&&event.which!==MOUSE_CLICK_CODE){return;}
var value=sanitarize(queryInput.value);if(!value||value.trim().length==0){return;}
queryInput.value="";resultWrapperDiv.scrollTop=resultWrapperDiv.scrollHeight;createQueryNode(value);var responseNode=createResponseNode();sendText(value).then(function(response){var result;try{result=response}catch(error){result="";}
setResponseOnNode(result,responseNode);}).catch(function(err){setResponseOnNode("Unable to process that. Can I connect you to a human?",responseNode);});}
function createQueryNode(query){var parentNode=document.createElement('div');var node=document.createElement('div');node.className="clearfix left-align window__chatVisitorMessage text-darken-2";node.innerHTML=sanitarize(query);if(textAlignment==='right'){parentNode.className='clearfix right-align card-panel queryParent hoverable';parentNode.appendChild(node);resultDiv.appendChild(parentNode);}else{parentNode.className='clearfix left-align card-panel queryParent hoverable';parentNode.appendChild(node);resultDiv.appendChild(parentNode);}
resultWrapperDiv.scrollTop=resultWrapperDiv.scrollHeight;}
function createResponseNode(){var parentNode=document.createElement('div');var node=document.createElement('div')
if(textAlignment==='right'){parentNode.className='clearfix left-align left responseParent';parentNode.appendChild(node);}else{parentNode.className='clearfix right-align';parentNode.appendChild(node);}
node.innerHTML="...";resultDiv.appendChild(parentNode);resultWrapperDiv.scrollTop=resultWrapperDiv.scrollHeight;return node;}
function createLoginNode(){var node=document.createElement('div')
node.className="clearfix left-align right card-panel black-text text-darken-2 hoverable";node.innerHTML='';resultDiv.appendChild(node);return node;}
function setResponseOnNode(response,node){if(response){node.className="clearfix left-align card-panel black-text text-darken-2 hoverable";try{if(typeof response=='object'&&typeof response.data!="undefined"){var finaldiv=document.createElement('div');if(response.data.length>1){addCrsl(response.data,finaldiv);node.innerHTML='';node.appendChild(finaldiv);}else if(response.data.length==1){addCard(response.data[0],finaldiv);node.innerHTML='';}else{}
node.appendChild(finaldiv);}else if(typeof response.text!="undefined"){node.innerHTML="<br/>";var textNode=document.createTextNode(response.text);node.appendChild(textNode);node.innerHTML+="<br/>"}else node.innerHTML="Unable to get response from server. Please try again later.";}catch(e){node.innerHTML='';node.innerHTML=sanitarize(response);}}else node.innerHTML="Unable to connect";node.setAttribute('data-actual-response',response);resultWrapperDiv.scrollTop=resultWrapperDiv.scrollHeight;}
function addCrsl(data,node){var crslnode=document.createElement('div');crslnode.className='slide-container hoverable clearfix'
setTimeout(function(){var slider=$(".slide-container").not('.slick-initialized').slick({infinite:false,slidesToShow:1,slidesToScroll:1,prevArrow:'<button type="button" class="slick-prev fa fa-angle-left fa-2x"></button>',nextArrow:'<button type="button" class="slick-next fa fa-angle-right fa-2x"></button>',});$('.next').click(function(){$('.slide-container').slick('slickNext');});$('.previous').click(function(){$('.slide-container').slick('slickPrev');});$('.slide-container').on('beforeChange',function(event,slick,currentSlide,nextSlide){if(nextSlide==slick.slideCount-1){$('.next').hide();$('.previous').show();}else if(nextSlide!=slick.slideCount-1&&nextSlide!=0){$('.next').show();$('.previous').show();}else if(currentSlide==0||nextSlide==0){$('.next').show();$('.previous').hide();}});},100);for(var i=0;i<data.length;i++){addCard(data[i],crslnode);}
node.appendChild(crslnode);}
function addCard(datum,node){var divnode=document.createElement('div');divnode.className+='carrousel new accent-4';if(typeof datum.image_url!='undefined'&&datum.image_url!=null){addImage(datum.image_url,divnode);}
if(typeof datum.title!='undefined'){var cardTitle=document.createElement("span");cardTitle.className="card-title";cardTitle.innerHTML=sanitarize(datum.title);divnode.appendChild(cardTitle);if(typeof datum.subtitle!='undefined'){var cardSubTitle=document.createElement("span");cardSubTitle.className="card-subtitle";cardSubTitle.innerHTML=sanitarize(datum.subtitle);divnode.appendChild(cardSubTitle);}}
removeSuggestions()
if(typeof datum.buttons!='undefined'){renderSuggestions(datum.buttons)}
node.appendChild(divnode);}
function addImage(str,node){var imgNode=document.createElement('img');imgNode.class+='cardimage';imgNode.setAttribute('src',str);node.appendChild(imgNode);}
function addBtn(btnJson,node){var buttonnode=document.createElement('input');buttonnode.setAttribute('type','button');buttonnode.setAttribute("onkeydown","if(event.which || event.keyCode){if (event.keyCode == 13) return false;}");buttonnode.className+='sgstnbtns';buttonnode.setAttribute('value',btnJson.title);node.appendChild(buttonnode);if(btnJson.type&&btnJson.type=="web_url"){buttonnode.addEventListener('click',function(){addUrlInput(btnJson.url);});}else if(btnJson.type&&btnJson.type=="phone_number"){buttonnode.addEventListener('click',function(){addPhoneInput(btnJson.payload);});}else if(btnJson.type&&btnJson.type=="account_link"){if(typeof btnJson.url=="undefined"){buttonnode.addEventListener('click',function(){showLoginInput(btnJson.lblusr,btnJson.lblpwd,btnJson.lblsubmit);});}else{addUrlInput(btnJson.url);}}else if(btnJson.payload){buttonnode.addEventListener('click',function(){addUserInput(btnJson.payload);});}}
function setResponseJSON(response){var node=document.getElementById("jsonResponse");node.innerHTML=JSON.stringify(sanitarize(response),null,"/n");}
function sendRequest(){}
function renderSuggestions(buttons){var allSelects=document.getElementsByClassName("responseParent");var lastSelect=allSelects[allSelects.length-1];var sgNode=document.createElement('div');sgNode.className='clearfix sgNode';addSuggestions(buttons,sgNode);$(sgNode).insertAfter(lastSelect);sgNode.setAttribute("onload",test());}
function test(){setTimeout(function(){resultWrapperDiv.scrollTop=resultWrapperDiv.scrollHeight;},200);}
function removeSuggestions(){if(document.getElementsByClassName("sgNode")[0]){document.getElementsByClassName("sgNode")[0].remove();}}
function addSuggestions(buttons,node){if(buttons.length>2){node.classList.add("h");setTimeout(function(){var slider=$(".sgNode").not('.slick-initialized').slick({infinite:false,draggable:false,slidesToShow:1,slidesToScroll:1,variableWidth:true,mobileFirst:true,prevArrow:'<button type="button" class="slick-prev fa fa-angle-left fa"></button>',nextArrow:'<button type="button" class="slick-next fa fa-angle-right fa"></button>',});node.classList.remove("h");},200);}
for(var i=0;i<buttons.length;i++){addBtn(buttons[i],node);}}})();
